var __reflect = (this && this.__reflect) || function (p, c, t) {
    p.__class__ = c, t ? t.push(c) : t = [c], p.__types__ = p.__types__ ? t.concat(p.__types__) : t;
};
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var ExploitScene = (function (_super) {
    __extends(ExploitScene, _super);
    function ExploitScene() {
        var _this = _super.call(this) || this;
        _this.gameTypeId = 0; //从0开始
        _this.addEventListener(eui.UIEvent.COMPLETE, _this.onComplete, _this);
        _this.skinName = "resource/wnd/ExploitWnd.exml";
        return _this;
    }
    ExploitScene.prototype.onComplete = function () {
        this.init();
    };
    ExploitScene.prototype.init = function () {
        this.initListener();
        // if(WndManager.root.main.protocol.jumpGametypeId >0)
        // {
        // 	this.gameTypeId = WndManager.root.main.protocol.jumpGametypeId;
        // 	this.handleSKGExploitClick(null);
        // }
        // else
        // {
        this.handleTotalExploitClick(null);
        //}
    };
    ExploitScene.prototype.initListener = function () {
        this.addEventListener("openSKGExploit", this.openSKGExploit, this);
        this.addEventListener("openSRExploit", this.openSRExploit, this);
        this.rectTotalExploit.addEventListener(egret.TouchEvent.TOUCH_TAP, this.handleTotalExploitClick, this);
        this.rectSKGExploit.addEventListener(egret.TouchEvent.TOUCH_TAP, this.handleSKGExploitClick, this);
    };
    //切换对应游戏战绩界面
    ExploitScene.prototype.openSKGExploit = function (e) {
        this.gameTypeId = Number(e.data);
        this.handleSKGExploitClick(null);
    };
    //打开单局战绩界面
    ExploitScene.prototype.openSRExploit = function (e) {
        var roomId = Number(e.data);
        var grd = WndManager.root.main.dataManager.MyExploit.getRoundDataByGameTypeAndRoomId(this.gameTypeId, roomId);
        if (null != grd) {
            var res = new RoundExploitScene(grd);
            this.addChild(res);
        }
    };
    //打开单局战绩界面,显示对应战绩
    ExploitScene.prototype.openFristSRExploit = function () {
        var grd = WndManager.root.main.dataManager.MyExploit.getNo1RoundDataByGameType(this.gameTypeId);
        if (null != grd) {
            var res = new RoundExploitScene(grd);
            this.addChild(res);
        }
    };
    //总战绩
    ExploitScene.prototype.handleTotalExploitClick = function (e) {
        this.imgExploitType.x = 35;
        this.lTotalExploit.textColor = 0xffffff;
        this.lSKGExploit.textColor = 0x68D9C3;
        this.gTotalExploit.visible = true;
        this.gSKGExploit.visible = false;
        this.initData();
    };
    //单个游戏战绩
    ExploitScene.prototype.handleSKGExploitClick = function (e) {
        this.imgExploitType.x = 321;
        this.lTotalExploit.textColor = 0x68D9C3;
        this.lSKGExploit.textColor = 0xffffff;
        this.gTotalExploit.visible = false;
        this.gSKGExploit.visible = true;
        this.initData();
    };
    ExploitScene.prototype.release = function () {
        this.removeEventListener("openSKGExploit", this.openSKGExploit, this);
        this.removeEventListener("openSRExploit", this.openSRExploit, this);
        this.rectTotalExploit.removeEventListener(egret.TouchEvent.TOUCH_TAP, this.handleTotalExploitClick, this);
        this.rectSKGExploit.removeEventListener(egret.TouchEvent.TOUCH_TAP, this.handleSKGExploitClick, this);
    };
    ExploitScene.prototype.initData = function () {
        //总战绩，所有游戏
        if (this.imgExploitType.x == 35) {
            this.initTotalExploitData();
        }
        else {
            this.initSRExploitData();
        }
    };
    //总战绩，所有游戏
    ExploitScene.prototype.initTotalExploitData = function () {
        this.lGameNum.text = WndManager.root.main.dataManager.MyExploit.TotalRounds.toString();
        this.lWinRate.text = WndManager.root.main.dataManager.MyExploit.WinRate.toString();
        this.lEscapeNum.text = WndManager.root.main.dataManager.MyExploit.TotalEscape.toString();
        this.scroller1.scrollPolicyH = eui.ScrollPolicy.OFF;
        this.exploitList1.dataProvider = new eui.ArrayCollection(WndManager.root.main.dataManager.MyExploit.GameRecordArrJsonString);
        this.exploitList1.itemRenderer = SKGExploitItemRender;
        this.scroller1.viewport = this.exploitList1;
        //计算默认游戏id
        this.gameTypeId = WndManager.root.main.dataManager.MyExploit.getDefaultGameId();
        if (WndManager.root.main.dataManager.MyExploit.GameRecordArrJsonString.length >= 6) {
            this.lNote.y = 200 + 6 * 100;
            this.scroller1.height = 6 * 100;
        }
        else {
            this.lNote.y = 200 + WndManager.root.main.dataManager.MyExploit.GameRecordArrJsonString.length * 100;
        }
        if (WndManager.root.main.protocol.jumpGametypeId > 0) {
            this.gameTypeId = WndManager.root.main.protocol.jumpGametypeId;
            this.handleSKGExploitClick(null);
        }
    };
    //某一类游戏 7天战绩
    ExploitScene.prototype.initSRExploitData = function () {
        console.log("gametype=" + this.gameTypeId);
        WndManager.root.main.protocol.addEventListener("OngetMyExploit", this.ongetMyExploit, this);
        WndManager.root.main.protocol.getMyExploit(this.gameTypeId);
        //if(this.gameTypeId>=0 && this.gameTypeId < WndManager.root.main.dataManager.MyExploit.GameRecordArr.length)
        {
            var gr = WndManager.root.main.dataManager.MyExploit.getGameRecordByGameType(this.gameTypeId);
            // this.lSKGTotalPoint.text = gr.TotalPoint.toString();
            this.lSKGTotalRounds.text = gr.TotalRound.toString();
            this.scroller2.scrollPolicyH = eui.ScrollPolicy.OFF;
            this.exploitList2.itemRenderer = SRExploitItemRender;
            this.scroller2.viewport = this.exploitList2;
        }
    };
    ExploitScene.prototype.ongetMyExploit = function (e) {
        this.exploitList2.dataProvider = new eui.ArrayCollection(WndManager.root.main.dataManager.MyExploit.getRoundDataArrByGameType(this.gameTypeId));
        if (WndManager.root.main.protocol.jumpGametypeId > 0) {
            WndManager.root.main.protocol.jumpGametypeId = 0;
            WndManager.root.main.protocol.jumpRoomKey = "";
            this.openFristSRExploit();
        }
    };
    return ExploitScene;
}(WinBase));
__reflect(ExploitScene.prototype, "ExploitScene");
//# sourceMappingURL=ExploitScene.js.map